name: Append Notebook Info to README

on:
  push:
    # Only run when a notebook (*.ipynb) is added
    paths:
      - "**/*.ipynb"

jobs:
  append_to_readme:
    runs-on: ubuntu-latest

    steps:
      # Checkout the repository
      - name: Checkout code
        uses: actions/checkout@v3

      # Extract the name of the new notebook and append the new entry to README.md
      - name: Append notebook info to README.md
        run: |
          # Get the name of the new notebook
          NEW_NOTEBOOK=$(git diff --name-only HEAD^ HEAD | grep '\.ipynb')

          # Extract the notebook project name (directory name) and notebook name
          PROJECT_NAME=$(basename $(dirname $NEW_NOTEBOOK))
          NOTEBOOK_NAME=$(basename $NEW_NOTEBOOK)

          # Generate the new table entry
          NEW_ENTRY="| $PROJECT_NAME | [$NOTEBOOK_NAME](./$NEW_NOTEBOOK) |  |  |"

          # Insert the new entry into the notebook table (before the last line)
          sed -i '$i'"$NEW_ENTRY" README.md

      # Configure git and commit the changes
      - name: Configure git
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

      # Add and commit the changes
      - name: Commit changes
        run: |
          git add README.md
          git commit -m "Added $NOTEBOOK_NAME to README.md"
          git push
        
